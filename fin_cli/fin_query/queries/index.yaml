version: 1
queries:
- name: accounts
  file: accounts.sql
  description: Account catalog with transaction and holdings stats.
  parameters:
    institution:
      type: string
      default: null
      description: Optional institution filter (exact match).
    account_type:
      type: string
      default: null
      description: Optional account type filter (exact match).
    limit:
      type: integer
      default: 100
      description: Maximum rows to return (0 for no limit).
- name: recent_transactions
  file: recent_transactions.sql
  description: Most recent transactions with category metadata.
  parameters:
    limit:
      type: integer
      default: 25
    month:
      type: string
      default: null
      description: Optional YYYY-MM filter applied to transaction date.
- name: transactions_range
  file: transactions_range.sql
  description: Transactions filtered by inclusive start / exclusive end dates.
  parameters:
    limit:
      type: integer
      default: 100
      description: Maximum rows to return (0 for no limit).
    start_date:
      type: string
      default: null
      description: Optional inclusive start date (YYYY-MM-DD).
    end_date:
      type: string
      default: null
      description: Optional exclusive end date (YYYY-MM-DD).
- name: category_summary
  file: category_summary.sql
  description: Total amount per category for the selected month.
  parameters:
    month:
      type: string
      required: true
      description: Required YYYY-MM period to summarise.
    account_id:
      type: integer
      default: null
      description: Optional account id filter.
- name: uncategorized
  file: uncategorized.sql
  description: Transactions missing category assignments.
  parameters: {}
- name: merchant_patterns
  file: merchant_patterns.sql
  description: Learned merchant pattern catalog with usage stats.
  parameters:
    limit:
      type: integer
      default: 50
    pattern:
      type: string
      default: null
      description: Optional LIKE filter (use % wildcards).
- name: recent_imports
  file: recent_imports.sql
  description: Most recently added transactions ordered by import timestamp.
  parameters:
    limit:
      type: integer
      default: 25
- name: categories
  file: categories.sql
  description: Category catalog with usage counts and approval flags.
  parameters:
    limit:
      type: integer
      default: 100
    category:
      type: string
      default: null
      description: Optional category LIKE filter.
    subcategory:
      type: string
      default: null
      description: Optional subcategory LIKE filter.
- name: transactions_month
  file: transactions_month.sql
  description: Transactions for a calendar month (aligned with fin-analyze windows).
  parameters:
    month:
      type: string
      required: true
      description: Month to filter in YYYY-MM format.
    account_id:
      type: integer
      default: null
      description: Optional account filter.
    category:
      type: string
      default: null
      description: Optional category LIKE filter (use % wildcards).
    subcategory:
      type: string
      default: null
      description: Optional subcategory LIKE filter (use % wildcards).
- name: merchants
  file: merchants.sql
  description: Merchant frequency table for prompt building.
  parameters:
    min_count:
      type: integer
      default: 1
      description: Minimum number of transactions required to include a merchant.
- name: merchant_search
  file: merchant_search.sql
  description: Transactions matching merchants via SQL LIKE patterns.
  parameters:
    pattern:
      type: string
      required: true
      description: LIKE pattern to match merchants (use % wildcards, case-sensitive).
    limit:
      type: integer
      default: 25
- name: category_transactions
  file: category_transactions.sql
  description: Transactions filtered by category and optional subcategory.
  parameters:
    category:
      type: string
      default: null
      description: Category filter (use % wildcards; NULL returns all categories).
    subcategory:
      type: string
      default: null
      description: Optional subcategory filter (use % wildcards).
    limit:
      type: integer
      default: 100

# Asset Tracking Queries
- name: holding_latest_values
  file: holding_latest_values.sql
  description: Latest valuation for each holding using source priority then recency.
  parameters:
    account_id:
      type: integer
      default: null
      description: Optional account filter.
    status:
      type: string
      default: active
      description: Holding status filter (active, closed, or null for all).
    limit:
      type: integer
      default: 200

- name: portfolio_snapshot
  file: portfolio_snapshot.sql
  description: Current portfolio snapshot with holdings, values, and classifications.
  parameters:
    as_of_date:
      type: string
      default: null
      description: Optional date for point-in-time snapshot (YYYY-MM-DD). Defaults to latest.
    account_id:
      type: integer
      default: null
      description: Optional account filter.
    limit:
      type: integer
      default: 500

- name: allocation_by_class
  file: allocation_by_class.sql
  description: Allocation breakdown by main and sub asset class.
  parameters:
    as_of_date:
      type: string
      default: null
      description: Optional date for point-in-time snapshot (YYYY-MM-DD).
    account_id:
      type: integer
      default: null
      description: Optional account filter.

- name: allocation_by_account
  file: allocation_by_account.sql
  description: Allocation breakdown by account.
  parameters:
    as_of_date:
      type: string
      default: null
      description: Optional date for point-in-time snapshot (YYYY-MM-DD).

- name: stale_holdings
  file: stale_holdings.sql
  description: Holdings without recent valuation updates.
  parameters:
    days:
      type: integer
      default: 30
      description: Number of days to consider a holding stale.
    limit:
      type: integer
      default: 100

- name: holdings_missing_classification
  file: holdings_missing_classification.sql
  description: Instruments without asset class assignments.
  parameters:
    limit:
      type: integer
      default: 100

- name: asset_classes
  file: asset_classes.sql
  description: Asset class taxonomy catalog.
  parameters:
    main_class:
      type: string
      default: null
      description: Optional main class filter.
    limit:
      type: integer
      default: 100

- name: instruments
  file: instruments.sql
  description: Instrument catalog with classifications.
  parameters:
    symbol:
      type: string
      default: null
      description: Optional symbol LIKE filter (use % wildcards).
    vehicle_type:
      type: string
      default: null
      description: Optional vehicle type filter.
    limit:
      type: integer
      default: 200

- name: holding_history
  file: holding_history.sql
  description: Value history for a specific holding over time.
  parameters:
    holding_id:
      type: integer
      required: true
      description: Holding ID to retrieve history for.
    limit:
      type: integer
      default: 365
